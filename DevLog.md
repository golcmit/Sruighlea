# 開発日記 - 2025/10/16

## 今日の目標
- プロジェクトの長期的な目標に基づき、データベーススキーマを全面的に再設計する。

## やったこと
1.  **設計方針の確立**:
    -   「誰でも使いやすい」「ハリポタ特化かつ汎用的」「複雑な関係性を扱える」「シンプルで保守しやすい」という4つの指針を定義した。

2.  **新スキーマの設計**:
    -   上記の指針に基づき、ブレインストーミングを通じて新しいデータベースの全体像を設計した。
    -   名前管理（JSON）、時間軸を持つ関係性、学業成績、役職、居住地や職歴の履歴など、物語の表現力を高めるための多くのアイデアを盛り込んだ。

3.  **設計のドキュメント化**:
    -   設計案をまとめたコンセプトドキュメントとして `neo_design/schema_draft.md` を作成した。
    -   最終的な設計に基づき、実際にデータベースを構築するためのSQL DDLを `neo_design/schema.sql` として書き出した。

4.  **テストデータベースの構築と検証**:
    -   `schema.sql` を実行し、新しいスキーマを持つテスト用データベース `neo_design/new_FanacalCharacters.db` を安全な場所に作成した。
    -   ハリーとハーマイオニーのテストデータを挿入し、二人の間に「友達」という双方向の関係性を登録するテストを実施。クエリを発行し、設計が意図通りに機能することを実証した。
    -   双方向の関係性の実装方法について議論し、アプリケーションロジックをシンプルに保つため、登録時に2つのレコードを書き込む「B案」を採用することを決定した。

## 成果
- プロジェクトの指針に沿った、堅牢で柔軟性の高い新しいデータベーススキーマが完成した。
- 設計内容がコンセプトドキュメントとSQLスクリプトの両方で明確に文書化され、今後の開発の強固な土台ができた。
- テストデータベースとテストデータを通じて、新しい設計の有効性が証明された。

## 次のステップ
- 以下のどちらかの作業に進むか、方針を決定する。
    1.  古いデータベースから新しいデータベースへ、データを移行するスクリプトを作成する。
    2.  C++アプリケーションのコードを、新しいデータベーススキーマに対応するようにリファクタリングする。

---

# 開発日記 - 2025/09/07

## 今日の目標
- 残っているタスクを片付け、アプリとしての一区切りをつける。

## やったこと
1.  **編集機能の完成 (TDD)**:
    -   ボタンクリックで編集ダイアログが開く機能を、テスト駆動で実装した。
    -   モーダルダイアログのテストで`exec()`がブロッキングする問題に直面したが、`#ifdef`を使ってテスト時のみ非モーダルで開くようにして解決した。

2.  **ロギング機構のリファクタリング**:
    -   TDDで、ファイル出力機能を持つシングルトンの`Logger`クラスを新規に作成。
    -   プロジェクト全体の`qDebug`や`qWarning`を、新しい`Logger`に置き換え、ログを一元管理できるようにした。この過程で、数々のビルドエラーと戦い、解決した。

3.  **v0.0.1-concept版のリリース準備**:
    -   `linuxdeployqt`を使い、依存ライブラリをバンドルした`AppImage`パッケージを作成。
    -   アーキテクチャの自動検出やアイコンファイル不足の問題を解決し、配布可能なパッケージを生成した。

4.  **リポジトリの整備**:
    -   ビルド生成物やデプロイメントファイルをGitの追跡対象から外すため、`.gitignore`を包括的に更新した。
    -   追跡済みの不要なファイルをインデックスから削除する手順を確立した。
    -   `README.md`を`Dev_memo.md`にリネームした。

## 成果
- アプリのコア機能が、テストに支えられた形で、ほぼ完成した。
- ログが一元化され、今後の保守性やデバッグ効率が大きく向上した。
- 配布可能なAppImageパッケージが完成し、プロジェクトとしての一つの大きなマイルストーンに到達した。
- Gitリポジトリが整理され、健全な開発を続けられるようになった。

## 次のステップ
- `TASKS.md`に残っているUI改善タスク（アイコン設定、UIのスタイリング）に取り組む。

---

# 開発日記 - 2025/09/05

## 今日の目標
- 「キャラクター編集機能」のUI部分をTDDで実装する。

## やったこと
1.  **UIのTDD (Red)**:
    -   `test_mainwindow.h`に宣言されていた`testEditCharacterButton_ButtonExists`を`test_mainwindow.cpp`に実装した。
    -   ビルドとテスト実行を行い、テストが「編集ボタン(`editCharacterButton`)が見つからない」という意図した通りに失敗することを確認した。

2.  **UIのTDD (Green & Refactor)**:
    -   当初、メインウィンドウに「編集ボタン」を配置してテストをパスさせたが、ユーザーからのフィードバックで、ボタンは「詳細ビュー」にあるべきだと判断。
    -   実装を元に戻し、再度TDDの「Green」ステップを実施。
    -   `MainWindow`の右側パネルを`QTextEdit`から、`QTextEdit`と`QPushButton`を内包する新しい`QWidget` (`characterDetailsView`) に変更。
    -   `characterDetailsView`内に`editCharacterButton`を配置し、すべてのテストがパスすることを確認した。

3.  **ドキュメント更新**:
    -   `TASKS.md`の「編集ボタンの追加」タスクを、正しい実装内容に合わせて完了済みに更新した。

## 成果
- ユーザーのフィードバックを反映し、TDDサイクルを回しながら、より適切なUIとして「編集ボタン」を詳細ビューに配置できた。
- 一度実装した内容を安全に巻き戻し、再度正しい設計で実装し直すという、テストに支えられた開発の柔軟性を実証できた。

## 次のステップ
- 「キャラクター編集機能」の本格的な実装（ダイアログの表示、データ更新処理）をTDDで進める。

---

# 開発日記 - 2025/09/02

## 今日の目標
- 「キャラクター新規追加機能」をTDDで実装する。
- 「キャラクター編集機能」に着手する。

## やったこと
1.  **「キャラクター新規追加機能」の実装 (TDD)**:
    -   **バックエンド**: 既存のテストと実装がすでに存在していたため、テストを実行し、すべてパスすることを確認した。
    -   **UI (Red)**: `MainWindow`に「新規追加ボタン」が存在しないことを検証するUIテスト (`testAddCharacterButton_ButtonExists`) を追加し、意図通りに失敗することを確認した。
    -   **UI (Green)**: `MainWindow`に`QPushButton`を追加し、テストをパスさせた。
    -   **ダイアログ実装**:
        -   キャラクター情報を入力するための`AddCharacterDialog`クラスを新規に作成 (`.h`, `.cpp`)。
        -   プロジェクトファイル (`.pro`) に新しいファイルを追加。
        -   「新規追加ボタン」のクリックシグナルに、ダイアログの表示、`CharacterService`へのデータ連携、リストの更新を行うスロットを接続した。
    -   `TASKS.md`の関連タスクを完了済みに更新した。

2.  **「キャラクター編集機能」の実装 (バックエンドTDD)**:
    -   **Red**: `CharacterService`にキャラクター情報を更新する`updateCharacter`メソッドを想定し、失敗するテスト (`testUpdateCharacter_ValidData_UpdatesInDb`) を先行して作成した。
    -   **ビルドエラーの解決**:
        -   テストのビルド時に、`AddCharacterDialog`に関するリンカーエラーが頻発した。
        -   原因を調査した結果、`tests/tests.pro`で`moc`が正しく実行されていないことを特定。`VPATH`と`INCLUDEPATH`を適切に設定することで`qmake`の問題を解決し、ビルドを成功させた。
    -   **Green**: `CharacterService`に`updateCharacter`メソッドを実装し、すべてのテストがパスすることを確認した。
    -   **次のステップの準備**: UI側のTDDの準備として、`test_mainwindow.h`に「編集ボタン」を検証するためのテスト宣言を追加した。

## 成果
- TDDサイクルを回し、「キャラクター新規追加機能」を完全に実装できた。
- 複雑なビルドエラーの原因を特定し、解決に導いたことで、Qtのビルドシステムに関する知見が深まった。
- 「キャラクター編集機能」のバックエンド部分をテストに支えられた形で完成させ、次のUI実装への強固な土台を築いた。

## 次のステップ
- 「キャラクター編集機能」のUI部分（編集ボタンの追加、ダイアログの表示など）をTDDで実装する。

---

# 開発日記 - 2025/08/15

## 今日の目標
- TDDサイクルを用いて、「検索・フィルター機能」を実装する。

## やったこと
1.  **バックエンドのTDD (Red-Green)**:
    -   **Red**: `CharacterService`に名前でキャラクターを検索する`searchCharactersByName`メソッドを想定し、失敗するテスト (`testSearchCharactersByName_ExistingName_ReturnsMatchingModel`) を先行して作成した。
    -   **Green**: テストをパスさせるため、`CharacterService`に`searchCharactersByName`の最小限の実装を追加した。テスト実行時にカラム名の指定ミスが発覚したが、修正してテストのパスを確認した。
2.  **バックエンドのリファクタリング**:
    -   `MainWindow`と`CharacterService`に重複して存在していたキャラクターリスト取得のSQLクエリを`CharacterService`に集約するリファクタリングを実施。`getCharacterListModel`メソッドを新設し、`MainWindow`から呼び出すように変更した。リファクタリング後も全てのテストがパスすることを確認した。
3.  **UIのTDD (Red-Green)**:
    -   **Red**: `MainWindow`に検索機能が存在しないことを検証するUIテスト (`TestMainWindow`) を作成した。当初、テストランナーが新しいテストを認識しない問題や、テスト実行時のデータベースパスの問題、テストコードのバグによるクラッシュなどが発生したが、これらを段階的に修正し、「検索ボックス(`searchLineEdit`)が見つからない」という意図した通りの失敗状態に到達させた。
    -   **Green**: `MainWindow`に`QLineEdit`（検索ボックス）を追加し、その`textChanged`シグナルをトリガーにして`CharacterService`の検索メソッドを呼び出し、テーブルのモデルを更新するスロットを実装した。これにより、UIテストを含む全てのテストがパスすることを確認した。
4.  **UIのリファクタリング**:
    -   `MainWindow`内で、リストの初期読み込みと検索結果の表示の際に重複していたモデル更新のロジックを、プライベートヘルパーメソッド`updateCharacterViewModel`に抽出し、コードの可読性と保守性を向上させた。リファクタリング後も全てのテストがパスすることを確認した。

## 成果
- バックエンドのロジックからフロントエンドのUIまで、TDDのサイクルを完全に回して「検索・フィルター機能」を実装できた。
- 開発の途中で発生した数々の問題を、テストを道しるべに一つずつ解決し、堅牢な機能を完成させることができた。

## 次のステップ
- `TASKS.md`の次の項目である「キャラクター新規追加機能」の実装に着手する。

---

# 開発日記 - 2025/08/13

## 今日の目標
- `CharacterService`がデフォルトのデータベース接続を使用するように修正し、テストで検証する。
- 新しいメインウィンドウクラス (`MainWindow`) を作成し、キャラクターリスト表示と詳細表示機能を実装する。

## やったこと
1.  **`CharacterService`のデータベース接続の共通化**:
    -   `CharacterService`が`test_connection`ではなく、デフォルトのデータベース接続を使用するように修正した。
    -   TDDサイクル（Red-Green-Refactor）を適用し、新しいテストケース`testFetchCharacterDetails_DefaultConnection_ValidId_ReturnsData()`を追加して、この変更が正しく機能することを検証した。
    -   既存のテストケースもデフォルト接続を使用するように修正し、全てのテストがパスすることを確認した。
2.  **メインウィンドウの再構築と詳細表示機能の実装**:
    -   実験用の`main.cpp`から独立させ、`QMainWindow`を継承した新しい`MainWindow`クラス (`src/mainwindow.h`, `src/mainwindow.cpp`) を作成した。
    -   `MainWindow`クラス内でデータベース接続を確立し、UIの初期化、キャラクターリストの読み込みを行うようにした。
    -   `QSplitter`を使用して、左側にキャラクターリスト (`QTableView`)、右側にキャラクター詳細表示 (`QTextEdit`) を配置するUIを構築した。
    -   キャラクターリストで選択された行のIDを取得し、`CharacterService`を介して詳細情報を取得、詳細表示パネルに表示する機能を実装した。
    -   `main.cpp`を修正し、`MainWindow`クラスを起動するように変更した。
    -   `Sruighlea.pro`に新しい`mainwindow.h`と`mainwindow.cpp`を追加した。
    -   アプリケーションをビルドし、期待通りに動作することを確認した。

## 成果
- `CharacterService`がアプリケーションのメインデータベース接続を正しく利用できるようになり、テストによってその動作が保証された。
- 新しい`MainWindow`クラスを基盤とした、キャラクターリスト表示と詳細表示機能を備えたGUIアプリケーションのプロトタイプが完成した。これにより、今後のUI開発の明確な基盤ができた。

## 次のステップ
- `TASKS.md`に記載されている次の機能（例: 検索・フィルター機能、キャラクター追加機能など）の実装に着手する。

# 開発日記 - 2025/08/11

## 今日の目標
- 「キャラクター詳細表示機能」の実装に着手し、TDDの開発サイクルを確立する。

## やったこと
1.  **開発プロセスの導入**:
    -   今後の開発方針として、テスト駆動開発（TDD）を導入することで合意。
    -   機能要求を管理するための `TASKS.md` を作成。
2.  **UI/UX改善**:
    -   `main.cpp` を修正し、アプリケーションのウィンドウサイズを変更した際に、キャラクターリストのテーブルも追従してリサイズされるように改善。
3.  **テスト環境の構築**:
    -   `QTest` フレームワークを利用するため、`tests` ディレクトリとテスト専用のプロジェクトファイル (`tests.pro`) をセットアップした。
4.  **TDDサイクルの実践 (Red-Green-Refactor)**:
    -   **Red**: `CharacterService`（キャラクター情報を取得するクラス）がまだ存在しない状態で、その機能を検証する失敗するテストを先行して作成した。
    -   **Green**: 失敗するテストをパスさせるため、データベースからIDでキャラクター情報を取得する最小限のコードを `CharacterService` に実装した。
    -   **Refactor**: コードの可読性と保守性を向上させるため、マジックナンバー（列の番号指定）をカラム名での指定に修正した。

## 成果
- TDDの開発サイクル（Red-Green-Refactor）を一周させ、テストに完全に裏付けられた `CharacterService` クラスを完成させることができた。
- これにより、今後の機能追加を、品質を担保しながら進めるための強固な土台ができた。

## 次のステップ
- 完成した `CharacterService` を利用して、UI上でユーザーがキャラクターを選択した際に、その詳細情報を画面に表示する機能（フロントエンド部分）を実装する。

---

# 開発日記 - 2025/08/10

## 今日の目標
- C++とQtを使ったGUIアプリのプロジェクト環境を構築し、データベースへの接続を確立する。

## やったこと
1.  **Qt環境のセットアップ**:
    -   `qmake`コマンドでQtのインストール状況を確認。
    -   未インストールだったため、`apt`を使って`qtcreator`, `qtbase5-dev`, `qt5-qmake`をインストールした。
2.  **プロジェクトファイル作成**:
    -   Qtプロジェクトファイル (`Sruighlea.pro`) を作成し、`core`, `gui`, `widgets`, `sql`モジュールを指定。
    -   アプリケーションのエントリーポイントとして`main.cpp`を作成。
3.  **データベース接続テスト**:
    -   `main.cpp`に`QSqlDatabase`を使って`FanacalCharacters.db`へ接続するコードを記述。
    -   ビルド時にインクルードエラーが発生。`.pro`ファイルに`widgets`モジュールが不足していたことが原因だった。
    -   `.pro`ファイルを修正後、ビルドと実行に成功。
    -   コンソールに "Database: connection ok" が表示され、接続を確認できた。

## 成果
- プロジェクトの雛形が完成し、最初のマイルストーンであるデータベース接続を達成した。

## 次のステップ
- データベースからキャラクターのリストを取得し、GUIのメインウィンドウに表示する機能の実装。