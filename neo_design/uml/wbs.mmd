graph TD
    %% --- Root ---
    Root("Sruighlea 再構築 WBS")

    %% --- Phase 1 ---
    P1("1.0 フェーズ 1: 基盤とデータモデル")
    Root --> P1

    P1_1("1.1 プロジェクト設定")
    P1_2("1.2 データモデル定義 (.h)")
    P1_3("1.3 サービス層インターフェース (CharacterService.h)")
    P1_4("1.4 初期実装 (一覧表示)")
    P1 --> P1_1
    P1 --> P1_2
    P1 --> P1_3
    P1 --> P1_4

    P1_1_1("1.1.1 DBパス修正")
    P1_1_2("1.1.2 接続確認")
    P1_1 --> P1_1_1
    P1_1 --> P1_1_2

    P1_2_1("1.2.1 Character.h")
    P1_2_2("1.2.2 OccupationRecord.h")
    P1_2_3("1.2.3 AcademicRecord.h")
    P1_2_4("1.2.4 Relationship.h")
    P1_2_5("1.2.5 GroupMembership.h")
    P1_2_6("1.2.6 AddressHistory.h")
    P1_2 --> P1_2_1
    P1_2 --> P1_2_2
    P1_2 --> P1_2_3
    P1_2 --> P1_2_4
    P1_2 --> P1_2_5
    P1_2 --> P1_2_6

    P1_3_1("1.3.1 既存メソッド削除")
    P1_3_2("1.3.2 閲覧系メソッド定義")
    P1_3_3("1.3.3 変更系メソッド定義")
    P1_3 --> P1_3_1
    P1_3 --> P1_3_2
    P1_3 --> P1_3_3

    P1_4_1("1.4.1 getCharacterListModel() 実装")
    P1_4_2("1.4.2 loadCharacterList() 修正")
    P1_4_3("1.4.3 [テスト] 一覧表示")
    P1_4 --> P1_4_1
    P1_4 --> P1_4_2
    P1_4 --> P1_4_3

    %% --- Phase 2 ---
    P2("2.0 フェーズ 2: 閲覧機能 (UI) 再設計")
    Root --> P2

    P2_1("2.1 MainWindow UI再設計 (QTabWidget)")
    P2_2("2.2 サービス層実装 (閲覧系)")
    P2_3("2.3 UIデータバインディング")
    P2_4("2.4 [テスト] 詳細閲覧")
    P2 --> P2_1
    P2 --> P2_2
    P2 --> P2_3
    P2 --> P2_4

    P2_1_1("2.1.1 QTextEdit削除 → QTabWidget配置")
    P2_1_2("2.1.2 [基本情報] タブレイアウト")
    P2_1_3("2.1.3 [経歴] タブ (TableView)")
    P2_1_4("2.1.4 [学業] タブ (TableView)")
    P2_1_5("2.1.5 [人間関係] タブ (TableView)")
    P2_1_6("2.1.6 その他タブ (所属/住所)")
    P2_1 --> P2_1_1
    P2_1 --> P2_1_2
    P2_1 --> P2_1_3
    P2_1 --> P2_1_4
    P2_1 --> P2_1_5
    P2_1 --> P2_1_6

    P2_2_1("2.2.1 getCharacterDetails() 実装")
    P2_2_2("2.2.2 getOccupationHistory() 実装")
    P2_2_3("2.2.3 getAcademicRecords() 実装")
    P2_2_4("2.2.4 getRelationships() 実装")
    P2_2_5("2.2.5 その他 (Group/Address)")
    P2_2 --> P2_2_1
    P2_2 --> P2_2_2
    P2_2 --> P2_2_3
    P2_2 --> P2_2_4
    P2_2 --> P2_2_5

    P2_3_1("2.3.1 on_characterTableView_clicked 修正")
    P2_3_2("2.3.2 [基本情報] タブ表示")
    P2_3_3("2.3.3 [経歴] タブ表示")
    P2_3_4("2.3.4 その他タブ表示")
    P2_3 --> P2_3_1
    P2_3 --> P2_3_2
    P2_3 --> P2_3_3
    P2_3 --> P2_3_4

    %% --- Phase 3 ---
    P3("3.0 フェーズ 3: 編集機能 (追加・更新) 実装")
    Root --> P3

    P3_1("3.1 [基本情報] 編集")
    P3_2("3.2 [経歴] 追加")
    P3_3("3.3 [人間関係] 追加")
    P3_4("3.4 その他タブ追加機能")
    P3_5("3.5 [テスト] データ追加")
    P3 --> P3_1
    P3 --> P3_2
    P3 --> P3_3
    P3 --> P3_4
    P3 --> P3_5

    P3_1_1("3.1.1 AddCharacterDialog 修正")
    P3_1_2("3.1.2 add/updateCharacter() 実装")
    P3_1_3("3.1.3 MainWindowボタン接続修正")
    P3_1 --> P3_1_1
    P3_1 --> P3_1_2
    P3_1 --> P3_1_3

    P3_2_1("3.2.1 [新規] AddOccupationDialog 作成")
    P3_2_2("3.2.2 addOccupationRecord() 実装")
    P3_2_3("3.2.3 [経歴] タブに「追加」ボタン実装")
    P3_2 --> P3_2_1
    P3_2 --> P3_2_2
    P3_2 --> P3_2_3

    P3_3_1("3.3.1 [新規] AddRelationshipDialog 作成")
    P3_3_2("3.3.2 addRelationship() 実装 (inverse考慮)")
    P3_3_3("3.3.3 [人間関係] タブに「追加」ボタン実装")
    P3_3 --> P3_3_1
    P3_3 --> P3_3_2
    P3_3 --> P3_3_3
    
    P3_4_1("3.4.1 [学業] [所属] [住所] のダイアログ・サービス・UI実装")
    P3_4 --> P3_4_1

    %% --- Phase 4 ---
    P4("4.0 フェーズ 4: 仕上げと高度な機能")
    Root --> P4

    P4_1("4.1 検索機能の再実装")
    P4_2("4.2 JSONフィールド対応")
    P4_3("4.3 エラーハンドリング")
    P4_4("4.4 最終テスト")
    P4 --> P4_1
    P4 --> P4_2
    P4 --> P4_3
    P4 --> P4_4

    P4_1_1("4.1.1 searchCharactersByName() 実装")
    P4_1_2("4.1.2 on_searchTextChanged 修正")
    P4_1 --> P4_1_1
    P4_1 --> P4_1_2

    P4_2_1("4.2.1 サービス (JSONパース)")
    P4_2_2("4.2.2 UI表示 (JSONデータ)")
    P4_2_3("4.2.3 ダイアログ編集 (JSON)")
    P4_2_4("4.2.4 サービス (JSON保存)")
    P4_2 --> P4_2_1
    P4_2 --> P4_2_2
    P4_2 --> P4_2_3
    P4_2 --> P4_2_4

    P4_3_1("4.3.1 サービス層 (Logger実装)")
    P4_3_2("4.3.2 UI層 (QMessageBox通知)")
    P4_3 --> P4_3_1
    P4_3 --> P4_3_2

    P4_4_1("4.4.1 全機能 通しテスト")
    P4_4 --> P4_4_1